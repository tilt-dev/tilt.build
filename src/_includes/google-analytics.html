
{%- if jekyll.environment == 'production' and site.google_analytics -%}

{%- if site.optimize_id -%}
  <!-- 
  Anti-flicker snippet (recommended)  
  https://support.google.com/optimize/answer/7100284
  -->
  <style>.async-hide { opacity: 0 !important} </style>
  <script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
})(window,document.documentElement,'async-hide','dataLayer',4000,
{'{{ site.optimize_id }}':true});
</script>
{%- endif -%}

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  {%- if site.optimize_id -%}
    gtag('config', '{{ site.google_analytics }}', { 'optimize_id': '{{ site.optimize_id }}'});
  {% else %}
    gtag('config', '{{ site.google_analytics }}');
  {%- endif -%}
</script>

{% else %}

<script>
  function gtag() {
    console.log('TiltFakeAnalytics', [].concat(arguments))
  }
</script>

{%- endif -%}

